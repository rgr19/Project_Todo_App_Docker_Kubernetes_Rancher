dist: trusty
sudo: required
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- "./task/setup/install/docker_install.sh"
env:
  global:
    secure: J3BLjKM527aOPWTGVlckCTJXlb3dlFZGZgoGRph6rlo+/yx+leJ0JfjeSJCNsIGlyHrupcx4m70ubRH48vgY8QsFH5WwGXDBoyxBoNlvXGBwH1RCbrMNpb1P8uAPFgIC1MtKY9YmcL5lTzv5tRwCBNOyexuc+oV0KiAVZOGtfAgEZ03mHXLSJZcSQMBV1o5LpmfgrixU/jBlRDTlTZB55MFK2N2ZZqVUOpnf/qoiLL8rw1hNPk/PzPkd+jczQmju6FHuqCxmHWDBhI5POEf4ejlfQ49+OZFzaqAblN3EeG43jRXDLpKZAgoOpE2JXuRylMgfGanvyjXMmeq/B+UhI/4QSpIXNeE6WRB+pNAOl/ZeUEPoX+8qCqqI+1daKAkGIELPBbmJCLdcdHUsETj2XmhSkP0sdVOzALk90enoD8V2sE7g98rJpDnTqTwavCO0moNuWs2Dw8v8RfZetEugCHZwg9KC5/LNmT9wKJJpXyAkbCz50nz21689gYYhcE7mL+lj/ZmOcye2DP+OVoQOxqshELnkSFbMWb+KVuYA2+6uVWQXqUZxuoK4efZZeA/1Q1PH1q30p4AZSlgjwN4zbW+UBEE3iAtrE8qVYFb6jfgv/9wLYJxIPOKfMpEajimfOjFWdYwbdBCz0FaTw9wm7CL7lOZCBtVupojWdvWqef4=
before_script:
- docker build ./src/todo-view -f ./src/todo-view/Dockerfile.dev -t $DOCKER_HUB_ID/todo-view-test
- docker build ./src/todo-cache-service -f ./src/common/Dockerfile.nodejs.dev -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- "./prod_dc build"
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- "./prod_dc push"
deploy:
  provider: elasticbeanstalk
  region: us-east-2
  app: Todo App
  env: todo-app-env
  bucket_name: elasticbeanstalk-us-east-2-277466026916
  bucket_path: todo-app
  on:
    branch: "$GITHUB_BRANCH"
  access_key_id: "$AWS_KEY_ID"
  secret_access_key:
    secure: "$AWS_SECRET_KEY"
