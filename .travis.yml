dist: trusty
sudo: required
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- "./task/setup/install/docker_install.sh"
env:
  global:
    secure: Lh0JXj9SREOroF+V+GYLqZoIaRIku/U/eqWdI9zfVGug151HEd7jrmW9c8Q5QmO/wi9Mf8e1XY2e72VSELOqDb4xqmfo26R7pJsU4U6dGNSJZmyGGrtWN6q5kTA7HjX4wJQjgqOPDoaTbBKVeR9vJrqoY1KkW3C6PT7xOH6PulUBAENvuazLWV7oqkXxGsKX3Zk0YyDvUS+7Zh8ibJQZ079nWKFUEmnmZ9THRUo7I+O5JHUnNBT+BJauiY6n6MhpqTs/1bvbN3IppemODkDrFgqZNjvbkiEkCfqgTidkHBZvBxHhKUmhN6FxXGSjGj4rSd8++EaOxR2X0moZ5pSVCKul0z2/xg3UVgh7ymldtD/9AQerYUJXPThiq6T9CAqSByJtisF/B6YVMhMzMe/zzJbxmAOgnmjXbzqe3ezZGAsxbwsdcEpqRc/48N8Al2gs7W2QFkRnNSLqqPB7ZwPHDUabqWGvpk9hNhR45gHBpz2PebK+hcWzBeIVG8sXoWaLp/94WyZVs39QVbh0XRp2PAtq/tjkhtH2Zud7D//wevG5qmENFTPV1YxEsYaiGv8O4CDMqIsfZa0uLEx11vZCOYvdwyNZcnSRSwj1ti31DEef41Khkl+A0w0pg4jichVWOGhZWNNWayBDZIUqmhn7M/37cEk2H402jgdQMitmMeU=
before_script:
- docker build ./src/todo-view -f ./src/todo-view/Dockerfile.dev -t $DOCKER_HUB_ID/todo-view-test
- docker build ./src/todo-cache-service -f ./src/common/Dockerfile.nodejs.dev -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- "./prod_dc build"
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- "./prod_dc push"
before_deploy:
- 
deploy:
  provider: elasticbeanstalk
  region: us-east-2
  app: Todo App
  env: todo-app-env
  bucket_name: elasticbeanstalk-us-east-2-277466026916
  bucket_path: todo-app
  on:
    branch: "$GITHUB_BRANCH"
  access_key_id: "$AWS_KEY_ID"
  secret_access_key:
    secure: "$AWS_SECRET_KEY"
