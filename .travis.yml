dist: trusty
sudo: required
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- "./task/setup/install/docker_install.sh"
env:
  global:
    secure: hywXQ98fCe1vYHZstjiIlFFhKkfdAFEnUDaj/b0XbCToK8fIrZggCrOomdLtkisL+mSrUvzkXopL8RU8im77E9d3zwbKYQ24wMY5796M+emzh+X46XyqZT+5aI8R8X9vJKonLZHaTtSOlum+ksBWZwrECq6nwK2s81yM/EFMWlNt/YRZ2F578q2dMqOddmVrxC9alQHqtt3rPlzecPTMiy9qTfP0U8laPBNm6W69yFcfF1P7kTuQXyP+pPq4kN3UiBC+OrYwFJ2IO1dPtYTPEvH1AWkbjVQdUWoYuQ7O83zwBEICrFRX15IBAUIiMd4VWrj57NTXbolqcwt8MR2fAI8juUIwa58oihSpT3vLE2olhO4tqDOL9rnumNJj28kw6hvHUyq8WcANhv7DEKk5pzzSJt2mPNbJ/Agu+2pQEb1AqbYO4girSh6Tu7VlgmMcLtDhzLF+QAK3LivmrWB3RUi1XyCjVHaX9rXlIPLhJtSAhpMXq8CYDV3WwRqGYdp6NROxERQsdESUDUTnEE8Dd+kCcxIp5+o58SBvzgFwTPqEHSotYWi6pIEySsCT0eMgtW2VYYHgZk9jkKomJNtthdGnq77wtNLqICclLCyZtb3HLNNpdZjaBhrMDtbQ2FvubLo9rOwhZMM280coSMbDd9jVeB1V2lnRLy83cHjEB2E=
before_script:
- docker build ./src/todo-view -f ./src/todo-view/Dockerfile.dev -t $DOCKER_HUB_ID/todo-view-test
- docker build ./src/todo-cache-service -f ./src/common/Dockerfile.nodejs.dev -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- "./prod_dc build"
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- "./prod_dc push"
before_deploy:
- 
deploy:
  provider: elasticbeanstalk
  region: us-east-2
  app: Todo App
  env: todo-app-env
  bucket_name: elasticbeanstalk-us-east-2-277466026916
  bucket_path: todo-app
  on:
    branch: "$GITHUB_BRANCH"
  access_key_id: "$AWS_KEY_ID"
  secret_access_key:
    secure: "$AWS_SECRET_KEY"
