dist: xenial
sudo: required
language: python
python: 3.7
install:
- pip install -r requirements.txt
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- bash ./setup/fix/no_public_key_fix.sh
- bash ./setup/install/docker_install.sh
env:
  global:
    secure: cQa0VW/GM3KuIiyuPQTFjYyIoYdqbe0aKxjaSQeU/QSSbMfYcBm8/Jp1AbvONDJvJzoLQuO719y4XfPUw90P4ahY9CsYe80h3/cMku8eUsfRrgiGbWs8cRqnu5EfVm83URBMvCz4Vk8AXt4eKnpazhKqKxS9pRzQE2HWlHGSgSsyk4MoPsOlznRHL9uR2wtvPkCbU1j5CMcW9WFyn+mKDxYyoLSI2/8SMDtSj24XF/+Ssj6DKjtsDf7YNzYnlJwjKCSRqP6pSZXbREjMf2szCa3C2nDycXc1QOpoy/UugiGV9Bwx0s0dJeCoSgka1YLyvCId9fqx/TsDqqM3zLAb7wlU1/nieFrbA6oT3T93YTQYDz8onKsDxqJizK0BgH2GzEkoW++JK3rEFyw06uXe949UWAG4F/fxt6VWvqqx1LsRov2AKEr4JUL3dpd2ikWjVY4IKov6w9k8YBKoFWPEF2IKw3jpo4EomWApxkyYiMfWIx9R3646cF7SiNM1XPD5ZM/lQTySQEG66+xNRbDJh90WulWdiES85tx7iEvynEswycFyzzd0jtCKTxUBxS+BIoB6mqh6YCtQw0z/ETEYzyDobTKE4D6aAM6irzWXVB3iYvxRstuRGYzfbuysktWE4/xDkoo1Zpu6LwkVgpQ+cg8P6AKcTXTMtrn5jUr4Sp8=
before_script:
- docker build ./todo-app/src/todo-view -f ./todo-app/src/todo-view/Dockerfile.dev
  -t $DOCKER_HUB_ID/todo-view-test
- docker build ./todo-app/src/todo-cache-service -f ./todo-app/src/common/Dockerfile.nodejs.dev
  -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- python3.7 main.py DC BUILD
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- python3.7 main.py DC PUSH
