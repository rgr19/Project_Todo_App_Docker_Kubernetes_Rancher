dist: trusty
sudo: required
language: python
python: 3.7
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- bash ./setup/fix/no_public_key_fix.sh
- bash ./setup/install/docker_install.sh
env:
  global:
    secure: fML2sGO5iuTwV7CKanUynDT9pJJhB1lhgMuN5a5wVj0tQF/C+OnhJkGh4ju8GhIxUevszc+oUKk1/Nc6Fd1KEknPewhLKAFVsLvqfVo9yPi5Brq8WIriP0gtnvBsxW8rhLDWrhoPlD0ia88ff1TqQerQEocCk7/OUuaLQE/UzL8UBeYzL0ECT1EJ24tCc4W3hIdZjUKt47hh4L2AuUr8mpw2oUpQ/LZE5F68Sy/OOIS7RtQeuHJAPM2z5leD5hQltYagcEF4icc0LUfbgOQiUIjD9mB8KCXwQT3JO7pntjdVXmFKhniHNcqtogbhvL6B/toKf1sKy4T3wAaUMSX0WSoe1B4Z2ZEVRFXbri8phiWjdzds9q9ENgjM9Ks66/kg7sUOIjLr1aYP55dozi5XvLGBnHnR6z+wsTUCOrYeGfvaw2jEQdNErZ5b3pHwnIisCtOsQm8fp+DAiTKxE1ue0SjqbMdEV3vYqlPW4KetTb2t4AIAY6uAuVTS5M6BM9GdwAMkcsgRw+gs57B9lD4LPLuPJ8EMY3nyV0UHdy/knQ8cMJfi3pls0maSNMbIUf5ZLD8zFGJatzXjvaAMq2R/0A8U1aKwVQoNyx/hnkj+ioRKFkL/M9c5Z5mdhrfJgA/nYRCw+z+9AK7Br/dH/JhQMyqLYOw4FPQIoN1WMT2gT7w=
before_script:
- docker build ./todo-app/src/todo-view -f ./todo-app/src/todo-view/Dockerfile.dev
  -t $DOCKER_HUB_ID/todo-view-test
- docker build ./todo-app/src/todo-cache-service -f ./todo-app/src/common/Dockerfile.nodejs.dev
  -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- python3.7 main.py DC BUILD
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- python3.7 main.py DC PUSH
