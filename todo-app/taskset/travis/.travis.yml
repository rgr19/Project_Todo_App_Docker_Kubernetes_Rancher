dist: trusty
sudo: required
python:
- 3.7
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- bash ./setup/fix/no_public_key_fix.sh
- bash ./setup/install/docker_install.sh
env:
  global:
    secure: YhwPauyRZjHCWYWaH/NuE3rMo9m2/sXJrjc9z8D0S4+3GtUoyavFLVNAQaWx8/533/LBJ+Tec3CrvcWTxN/5RzhZ9CQD16g42uHEPrdNrMeAiTEthVC9kDbO4lGjzvlZVOeYWZac5X1+Q8OdQFy6x9c3rp5uBUsZKw8k/4mtJ22InOvTUc+7wqW/zOT/AjjhirG8GaqAxsIcV4Xt3rBngFAi04tvSodSpVeKkZZskjOAuVfoIPDtEtyKgd4579bK+EkScOMna5oT8SXOYUZZQaemnqSYdy9AQRNhC5b6Wc6jaAFiIS4PJtKEyz4jLNGY5x0LjGG81Pdz7uOMNEgrHnO0m0/6rf2S/0zpMPzzlqSdhz7FtOLrLBgv15KVrt2NLCYQNosUrh+M/hSp21mSclWOz1OmTvQV6SkCNWqX+aMlmV/K1DBmLjBOeYCEzkaLEO39l+WSGkn/AB5QNX8lsQcPVCh+i3MdH3d2wNs63k6UDyQA5B/uRquFwA5ID5GtUeW7qkEDdxMVzvG8MkppJZ3lP/xHMVebm3AHmEKAe3Vbe0ZYlWqb3CkUKbEuyLyvAyLgpJWAyLTWhtreenftIw07aE4OfKbfURu/IQBYts3aiAyoMC7zyMRdJjtH93+NZSm8sqLANCYjKU8HANDYD/iRHZANgyg1yNJWWWycpOs=
before_script:
- docker build ./todo-app/src/todo-view -f ./todo-app/src/todo-view/Dockerfile.dev
  -t $DOCKER_HUB_ID/todo-view-test
- docker build ./todo-app/src/todo-cache-service -f ./todo-app/src/common/Dockerfile.nodejs.dev
  -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- python3.7 main.py DC BUILD
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- python3.7 main.py DC PUSH
