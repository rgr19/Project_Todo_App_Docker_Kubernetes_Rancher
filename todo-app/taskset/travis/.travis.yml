dist: xenial
sudo: required
language: python
python: 3.7
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- bash ./setup/fix/no_public_key_fix.sh
- bash ./setup/install/docker_install.sh
env:
  global:
    secure: KFkeIR23NLFZV50my1nroakNN6RayM7AzfRBZj+5xbMmoGC+wTqWzE3ngALsC8g5Cf4KuiLrqc6+c6kM6hwG6frbZ+hfVJwpScRWUE7y9/6BjTUcuS5SHmEVmiEOJvy+RV3ErE1J/PD3xR1YnPSyqwyXqwkiGR1rpIrDoUdZ1igjlgtaoY2ccLaiqNG7FHrt4sPBg2bJFX01LmwMCX7OIG8g3l56s0XmbaEq4G2PE0nTi2NYc085N7FSyW9AFuxfL+0OS85x4FlnQzyPK8vfP4RTB0D9B1wTizCXPPxPkaTVFrHFMo65Y6/erDJhm5sFiONhsMOsT5aqKPPWaUhJ5z7ad8OvoKdUAkduNhPkUnRptVjq6+hzz1RbDNGV2Gh1hW6mgJYt7XcuhcvzcK7rVqxhxzrTdCEDjy8vEz1nIbc/y0t3VuvAZU74f70E1ZpbOey6gCrgboXxlyiFaBm55LS5YOmh5zT2vQuopbS0OFaHXEhU/MgXVCD7zzGIT4AkL3aFLAFj/Hl22xP+9idhgszOOApbOC06YXdIVe4FLJhgXXdkw1iGg2QQKZRu+Jfn/7HNXGyQJdwjw+N5Hd2rn78Hg9Av+wYNTCDqpKfS1C1pQLpmP1ZKkT1NmXP/no1TbiEzEvBtaPLFFd4zNK47L+04wEhIXuEPBxvH9izdoWo=
before_script:
- docker build ./todo-app/src/todo-view -f ./todo-app/src/todo-view/Dockerfile.dev
  -t $DOCKER_HUB_ID/todo-view-test
- docker build ./todo-app/src/todo-cache-service -f ./todo-app/src/common/Dockerfile.nodejs.dev
  -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- python3.7 main.py DC BUILD
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- python3.7 main.py DC PUSH
