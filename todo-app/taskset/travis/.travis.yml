dist: xenial
sudo: required
language: python
python: 3.7
install:
- pip install -r requirements.txt
services:
- docker
addons:
  apt:
    packages:
    - docker-ce
before_install:
- bash ./setup/fix/no_public_key_fix.sh
- bash ./setup/install/docker_install.sh
env:
  global:
    secure: S+5JYktFhlTJI4xKeLurmU37PaqxJDsrPEpeJJ7shKY4Gcyw2k3p2bvxpiq2Y7qBTWPyU8nBETnjobfarS6OomIEDBCn4/Z0u/1bWFP6K2G+JIW5sAQE+RZDteui+voxROOjbNT/1WM/75MsC/9NnJTyRr1i3jk744vC/cD4CkowS4oBkOcU19GE0XeRrIQQ9k3lk16xDvlrUm+EcmXXw/g0hkd3ozUoNtbfEmpAiQDaZ/FYiKm/oD0CzH6dsRZP/DIFCNPd5hSEdm7qFW7mZywYSPjVSTJK4rexxGcBbS6Gbbh2S314vdR1l2dp/J6e6C3Q5f/Q7LnBxtC/CaxGd/EmB2Wn/XvYp70e+Uda7z3XOJp73czfbfOzE/Y/6Kc7K6Yech9rFQ0W3JkwnbdIOqMRBWXsooFfjWoSkUK1IBSlIyJG2OecUBJMHww+/ONCopRD/JqBQbsbfFwPYq8gFZ9BjoQ9mn0caWjJTHk+iidIrGM/wzL+kA8nh6N6Lz9yrjb+2rJN86n8itX6PrrzFa0Uu2odkNy+cf1fQp4xFDsu+wG1P49n4MTDMaj2v3lKpkEpMgASb+5328zNhM7qTIdEmn0oqirqZ6WO4eBXxmgZ6j0uBSAeFW/LN4RwWxezjLGguctHfMN6kUvum6yEPJZ0sY5OgTsFIy0NaCc9qWM=
before_script:
- docker build ./todo-app/src/todo-view -f ./todo-app/src/todo-view/Dockerfile.dev
  -t $DOCKER_HUB_ID/todo-view-test
- docker build ./todo-app/src/todo-cache-service -f ./todo-app/src/common/Dockerfile.nodejs.dev
  -t $DOCKER_HUB_ID/todo-cache-service-test
script:
- docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox
  --watch=false --no-progress
- docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
- python3.7 main.py DC BUILD
- echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
- python3.7 main.py DC PUSH
