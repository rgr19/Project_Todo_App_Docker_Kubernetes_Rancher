dist: trusty
sudo: required
python:
  - 3.7
services:
  - docker
addons:
  apt:
    packages:
      - docker-ce
before_install:
  - bash ./setup/fix/no_public_key_fix.sh
  - bash ./setup/install/docker_install.sh
env:
  global:
    secure: VroWGvTuCTncu+llEAQ5HKzUvq3NgFO6jcCdGSUXHP3mFmjIt+T8G0DZnIe/E6n+imuwPlvCq5r7Y6Q5nIWVZtovdBTC5U5IhOq0hr0ZffyiHblCAF2pSVrdGGOzFKB1+RxVK1YBr1jrVDmlOJ9ueusSPtppbmHdy/m9R2qD6GLEAcEujatLvh7V0+IBp8DVGXEB9CiRpscks5NeX3X2SyVmBVbP7mOmwaf1QAslMTlqRprODWltHTUZgLmxNONSpRp17tnUTSGHWXxb9X6l03YDbwqkHY8/s3NrgYIVjTYv8qSb/VROmcoG2FXGgDf9vcLtjp2Vvox7h10cqNGoIGRuy4C1q0zm1Kl3q7VEcBwM4OJfDeyiT0hyZFSGDwf+GUV/WD3humjt8S77yFzUg4X7FmZ8KJMWSPAXOb9uRGGu3pFaUcvLl5PIsbK8t2IYpHX0Az7DriYD7qN7NHJwkKfjKyvWzKhOG+FG3HcaBY4zZA+XL00hREi/9b+LvI4xSI4FL9qLG8EAi7IQZrdl97Ftu6v4kDySqw2foFFNJo8bDO5fAOZDB35qwGEDyR19gpQ4q6/QlEiUMuDzkoR1f5AMmKqeHQNp0SSmk3L3Knf7hRYVRZkNlyfvCS6y+4aftwTi6kH3/i68qKXsR0NIqN5Q3xtvowlSvIX0cWrWuJc=
before_script:
  - docker build ./todo-app/src/todo-view -f ./todo-app/src/todo-view/Dockerfile.dev -t $DOCKER_HUB_ID/todo-view-test
  - docker build ./todo-app/src/todo-cache-service -f ./todo-app/src/common/Dockerfile.nodejs.dev -t $DOCKER_HUB_ID/todo-cache-service-test
script:
  - docker run $DOCKER_HUB_ID/todo-view-test npm test -- --browsers=ChromeHeadlessNoSandbox --watch=false --no-progress
  - docker run $DOCKER_HUB_ID/todo-cache-service-test npm test
after_success:
  - python3.7 main.py DC BUILD
  - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin
  - python3.7 main.py DC PUSH
